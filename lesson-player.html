<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>مشغل الدروس - منصة التعليم</title>
  
  <!-- Bootstrap + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --primary-color: #3498db;
      --secondary-color: #5dade2;
      --accent-color: #85c1e9;
      --success-color: #2ecc71;
      --warning-color: #f39c12;
      --dark-color: #2c3e50;
      --light-color: #ecf0f1;
    }
    
    body {
      font-family: 'Cairo', sans-serif;
      background: #1a1a1a;
      color: white;
      overflow-x: hidden;
    }
    
    .video-container {
      max-width: 1200px;
      margin: 0 auto;
      background: #000;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }
    
    .video-player {
      width: 100%;
      height: 70vh;
      background: #000;
      outline: none;
    }
    
    .controls-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(transparent, rgba(0,0,0,0.8));
      padding: 2rem;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .video-wrapper:hover .controls-overlay {
      opacity: 1;
    }
    
    .progress-container {
      width: 100%;
      height: 6px;
      background: rgba(255,255,255,0.3);
      border-radius: 3px;
      cursor: pointer;
      margin: 1rem 0;
    }
    
    .progress-bar {
      height: 100%;
      background: var(--primary-color);
      border-radius: 3px;
      width: 0%;
      transition: width 0.1s ease;
    }
    
    .control-buttons {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }
    
    .control-group {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .control-btn {
      background: none;
      border: none;
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 50%;
      transition: all 0.3s ease;
    }
    
    .control-btn:hover {
      background: rgba(255,255,255,0.1);
      transform: scale(1.1);
    }
    
    .time-display {
      font-size: 0.9rem;
      color: #ccc;
      font-variant-numeric: tabular-nums;
    }
    
    .speed-control {
      background: rgba(255,255,255,0.1);
      border: none;
      color: white;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .volume-control {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .volume-slider {
      width: 80px;
      height: 4px;
      background: rgba(255,255,255,0.3);
      border-radius: 2px;
      cursor: pointer;
    }
    
    .volume-level {
      height: 100%;
      background: white;
      border-radius: 2px;
      width: 100%;
    }
    
    .playback-rate {
      background: rgba(255,255,255,0.1);
      color: white;
      border: none;
      padding: 0.25rem 0.75rem;
      border-radius: 15px;
      font-size: 0.8rem;
      cursor: pointer;
    }
    
    .lesson-sidebar {
      background: #2d2d2d;
      border-radius: 12px;
      padding: 1.5rem;
      height: fit-content;
    }
    
    .lesson-list {
      max-height: 400px;
      overflow-y: auto;
    }
    
    .lesson-item {
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 0.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 1px solid #404040;
    }
    
    .lesson-item:hover {
      background: #404040;
    }
    
    .lesson-item.active {
      background: var(--primary-color);
      border-color: var(--primary-color);
    }
    
    .lesson-duration {
      font-size: 0.8rem;
      color: #ccc;
    }
    
    .completed-badge {
      background: var(--success-color);
      color: white;
      padding: 0.2rem 0.5rem;
      border-radius: 10px;
      font-size: 0.7rem;
    }
    
    .keyboard-shortcuts {
      background: #2d2d2d;
      border-radius: 12px;
      padding: 1.5rem;
      margin-top: 1rem;
    }
    
    .shortcut-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
      border-bottom: 1px solid #404040;
    }
    
    .shortcut-item:last-child {
      border-bottom: none;
    }
    
    .shortcut-keys {
      display: flex;
      gap: 0.25rem;
    }
    
    .key {
      background: #404040;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.8rem;
      font-family: monospace;
    }
    
    .fullscreen-btn {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1000;
    }
    
    .loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }
    
    .play-pause-overlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 4rem;
      color: white;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }
    
    .video-wrapper:hover .play-pause-overlay {
      opacity: 0.7;
    }
    
    .quality-selector {
      position: relative;
    }
    
    .quality-menu {
      position: absolute;
      bottom: 100%;
      left: 0;
      background: #2d2d2d;
      border-radius: 8px;
      padding: 0.5rem;
      min-width: 120px;
      display: none;
    }
    
    .quality-selector:hover .quality-menu {
      display: block;
    }
    
    .quality-option {
      padding: 0.5rem;
      cursor: pointer;
      border-radius: 4px;
    }
    
    .quality-option:hover {
      background: #404040;
    }
    
    .quality-option.active {
      color: var(--primary-color);
    }
    
    /* التمرير المخصص */
    .lesson-list::-webkit-scrollbar {
      width: 6px;
    }
    
    .lesson-list::-webkit-scrollbar-track {
      background: #404040;
      border-radius: 3px;
    }
    
    .lesson-list::-webkit-scrollbar-thumb {
      background: var(--primary-color);
      border-radius: 3px;
    }
    
    /* التكبير/التصغير السلس */
    .video-container.fullscreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 9999;
      border-radius: 0;
    }
    
    /* أنيميشن للتحكم */
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    
    .control-btn.pulsing {
      animation: pulse 0.5s ease;
    }
    
    /* التكيف مع الشاشات الصغيرة */
    @media (max-width: 768px) {
      .video-player {
        height: 50vh;
      }
      
      .controls-overlay {
        padding: 1rem;
      }
      
      .control-buttons {
        flex-wrap: wrap;
      }
      
      .control-group {
        flex: 1;
        justify-content: center;
      }
    }
  </style>
</head>
<body>

  <!-- زر الخروج من وضع الملء الشاشة -->
  <button class="btn btn-outline-light fullscreen-btn" id="exitFullscreen" style="display: none;">
    <i class="bi bi-fullscreen-exit"></i>
  </button>

  <div class="container-fluid py-4">
    <div class="row">
      <!-- المحتوى الرئيسي -->
      <div class="col-lg-9">
        <div class="video-container" id="videoContainer">
          <div class="video-wrapper position-relative">
            <video class="video-player" id="videoPlayer" crossorigin="anonymous">
              <!-- سيتم تعبئة مصدر الفيديو ديناميكياً -->
            </video>
            
            <!-- overlay للتحكم -->
            <div class="controls-overlay">
              <!-- شريط التقدم -->
              <div class="progress-container" id="progressContainer">
                <div class="progress-bar" id="progressBar"></div>
              </div>
              
              <!-- أزرار التحكم -->
              <div class="control-buttons">
                <div class="control-group">
                  <button class="control-btn" id="playPauseBtn" title="تشغيل/إيقاف (Space)">
                    <i class="bi bi-play-fill"></i>
                  </button>
                  
                  <button class="control-btn" id="rewindBtn" title="تراجع 10 ثواني (←)">
                    <i class="bi bi-arrow-counterclockwise"></i>
                  </button>
                  
                  <button class="control-btn" id="forwardBtn" title="تقديم 10 ثواني (→)">
                    <i class="bi bi-arrow-clockwise"></i>
                  </button>
                  
                  <span class="time-display">
                    <span id="currentTime">0:00</span> / <span id="duration">0:00</span>
                  </span>
                </div>
                
                <div class="control-group">
                  <!-- التحكم في السرعة -->
                  <select class="playback-rate" id="playbackRate" title="سرعة التشغيل (>)">
                    <option value="0.5">0.5x</option>
                    <option value="0.75">0.75x</option>
                    <option value="1" selected>1x</option>
                    <option value="1.25">1.25x</option>
                    <option value="1.5">1.5x</option>
                    <option value="2">2x</option>
                  </select>
                  
                  <!-- التحكم في الصوت -->
                  <div class="volume-control">
                    <button class="control-btn" id="muteBtn" title="كتم/إلغاء كتم الصوت (M)">
                      <i class="bi bi-volume-up-fill"></i>
                    </button>
                    <div class="volume-slider" id="volumeSlider">
                      <div class="volume-level" id="volumeLevel"></div>
                    </div>
                  </div>
                  
                  <!-- جودة الفيديو -->
                  <div class="quality-selector">
                    <button class="control-btn" id="qualityBtn" title="جودة الفيديو">
                      <i class="bi bi-gear-fill"></i>
                    </button>
                    <div class="quality-menu" id="qualityMenu">
                      <!-- سيتم تعبئة خيارات الجودة هنا -->
                    </div>
                  </div>
                  
                  <!-- وضع الملء الشاشة -->
                  <button class="control-btn" id="fullscreenBtn" title="ملء الشاشة (F)">
                    <i class="bi bi-arrows-fullscreen"></i>
                  </button>
                </div>
              </div>
            </div>
            
            <!-- overlay للتشغيل/الإيقاف -->
            <div class="play-pause-overlay" id="playPauseOverlay">
              <i class="bi bi-play-fill"></i>
            </div>
            
            <!-- overlay للتحميل -->
            <div class="loading-overlay" id="loadingOverlay">
              <div class="text-center">
                <div class="spinner-border text-primary mb-3"></div>
                <p>جاري تحميل الفيديو...</p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- معلومات الدرس -->
        <div class="row mt-4">
          <div class="col-12">
            <div class="card bg-dark text-white">
              <div class="card-body">
                <h3 id="lessonTitle">عنوان الدرس</h3>
                <p id="lessonDescription" class="text-muted">وصف الدرس سيظهر هنا...</p>
                <div class="d-flex gap-3 mt-3">
                  <span class="badge bg-primary" id="lessonDuration">--:--</span>
                  <span class="badge bg-success" id="lessonProgress">0% مكتمل</span>
                  <span class="badge bg-info" id="videoQuality">جودة عالية</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- الشريط الجانبي للدروس -->
      <div class="col-lg-3 mt-4 mt-lg-0">
        <div class="lesson-sidebar">
          <h5 class="mb-3">دروس الكورس</h5>
          <div class="lesson-list" id="lessonList">
            <!-- سيتم تعبئة قائمة الدروس هنا -->
          </div>
        </div>
        
        <!-- اختصارات الكيبورد -->
        <div class="keyboard-shortcuts">
          <h6 class="mb-3">اختصارات الكيبورد</h6>
          <div class="shortcut-item">
            <span>تشغيل/إيقاف</span>
            <div class="shortcut-keys">
              <kbd class="key">Space</kbd>
            </div>
          </div>
          <div class="shortcut-item">
            <span>تراجع 10 ثواني</span>
            <div class="shortcut-keys">
              <kbd class="key">←</kbd>
            </div>
          </div>
          <div class="shortcut-item">
            <span>تقديم 10 ثواني</span>
            <div class="shortcut-keys">
              <kbd class="key">→</kbd>
            </div>
          </div>
          <div class="shortcut-item">
            <span>كتم الصوت</span>
            <div class="shortcut-keys">
              <kbd class="key">M</kbd>
            </div>
          </div>
          <div class="shortcut-item">
            <span>ملء الشاشة</span>
            <div class="shortcut-keys">
              <kbd class="key">F</kbd>
            </div>
          </div>
          <div class="shortcut-item">
            <span>زيادة السرعة</span>
            <div class="shortcut-keys">
              <kbd class="key">></kbd>
            </div>
          </div>
          <div class="shortcut-item">
            <span>تقليل السرعة</span>
            <div class="shortcut-keys">
              <kbd class="key"><</kbd>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // نظام مشغل الفيديو المتقدم
    class AdvancedVideoPlayer {
      constructor() {
        this.video = document.getElementById('videoPlayer');
        this.currentLesson = null;
        this.lessons = [];
        this.isPlaying = false;
        this.isFullscreen = false;
        this.volume = 1;
        this.playbackRate = 1;
        this.init();
      }

      init() {
        this.setupEventListeners();
        this.loadCourseData();
        this.setupKeyboardShortcuts();
      }

      setupEventListeners() {
        // أحداث الفيديو
        this.video.addEventListener('loadedmetadata', () => this.onVideoLoaded());
        this.video.addEventListener('timeupdate', () => this.updateProgress());
        this.video.addEventListener('ended', () => this.onVideoEnded());
        this.video.addEventListener('waiting', () => this.showLoading());
        this.video.addEventListener('canplay', () => this.hideLoading());
        this.video.addEventListener('click', () => this.togglePlayPause());

        // أزرار التحكم
        document.getElementById('playPauseBtn').addEventListener('click', () => this.togglePlayPause());
        document.getElementById('rewindBtn').addEventListener('click', () => this.rewind(10));
        document.getElementById('forwardBtn').addEventListener('click', () => this.forward(10));
        document.getElementById('muteBtn').addEventListener('click', () => this.toggleMute());
        document.getElementById('fullscreenBtn').addEventListener('click', () => this.toggleFullscreen());
        document.getElementById('playbackRate').addEventListener('change', (e) => this.changePlaybackRate(e.target.value));

        // شريط التقدم
        document.getElementById('progressContainer').addEventListener('click', (e) => this.seek(e));
        
        // شريط الصوت
        document.getElementById('volumeSlider').addEventListener('click', (e) => this.changeVolume(e));

        // الخروج من وضع الملء الشاشة
        document.getElementById('exitFullscreen').addEventListener('click', () => this.exitFullscreen());
        
        // أحداث وضع الملء الشاشة
        document.addEventListener('fullscreenchange', () => this.handleFullscreenChange());
      }

      setupKeyboardShortcuts() {
        document.addEventListener('keydown', (e) => {
          // تجاهل الاختصارات إذا كان المستخدم يكتب في حقل إدخال
          if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;

          switch(e.key) {
            case ' ':
              e.preventDefault();
              this.togglePlayPause();
              break;
            case 'ArrowLeft':
              e.preventDefault();
              this.rewind(10);
              break;
            case 'ArrowRight':
              e.preventDefault();
              this.forward(10);
              break;
            case 'm':
            case 'M':
              e.preventDefault();
              this.toggleMute();
              break;
            case 'f':
            case 'F':
              e.preventDefault();
              this.toggleFullscreen();
              break;
            case '>':
              e.preventDefault();
              this.increaseSpeed();
              break;
            case '<':
              e.preventDefault();
              this.decreaseSpeed();
              break;
            case 'Escape':
              if (this.isFullscreen) {
                this.exitFullscreen();
              }
              break;
          }
        });
      }

      async loadCourseData() {
        try {
          // في التطبيق الحقيقي، سيتم جلب البيانات من API
          // هذه بيانات تجريبية للعرض
          this.lessons = [
            {
              id: 1,
              title: "مقدمة في البرمجة",
              description: "تعلم أساسيات البرمجة والمفاهيم الأساسية",
              videoUrl: "https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4",
              duration: "10:30",
              completed: true,
              quality: {
                '720p': "https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4",
                '480p': "https://sample-videos.com/zip/10/mp4/SampleVideo_640x360_1mb.mp4"
              }
            },
            {
              id: 2,
              title: "المتغيرات وأنواع البيانات",
              description: "فهم المتغيرات وأنواع البيانات في البرمجة",
              videoUrl: "https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_2mb.mp4",
              duration: "15:45",
              completed: false,
              quality: {
                '720p': "https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_2mb.mp4",
                '480p': "https://sample-videos.com/zip/10/mp4/SampleVideo_640x360_2mb.mp4"
              }
            },
            {
              id: 3,
              title: "الهياكل الشرطية",
              description: "تعلم استخدام if و else في البرمجة",
              videoUrl: "https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4",
              duration: "12:20",
              completed: false,
              quality: {
                '720p': "https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4",
                '480p': "https://sample-videos.com/zip/10/mp4/SampleVideo_640x360_1mb.mp4"
              }
            }
          ];

          this.renderLessonsList();
          this.loadLesson(this.lessons[0]);
        } catch (error) {
          console.error('Error loading course data:', error);
          this.showError('حدث خطأ في تحميل بيانات الدروس');
        }
      }

      renderLessonsList() {
        const lessonList = document.getElementById('lessonList');
        lessonList.innerHTML = this.lessons.map(lesson => `
          <div class="lesson-item ${this.currentLesson?.id === lesson.id ? 'active' : ''}" 
               onclick="videoPlayer.loadLesson(${lesson.id})">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <h6 class="mb-1">${lesson.title}</h6>
                <p class="mb-1 text-muted small">${lesson.description}</p>
                <span class="lesson-duration">${lesson.duration}</span>
              </div>
              <div>
                ${lesson.completed ? '<span class="completed-badge">مكتمل</span>' : ''}
              </div>
            </div>
          </div>
        `).join('');
      }

      loadLesson(lessonId) {
        const lesson = typeof lessonId === 'number' 
          ? this.lessons.find(l => l.id === lessonId)
          : lessonId;

        if (!lesson) return;

        this.currentLesson = lesson;
        this.showLoading();

        // تحديث واجهة المستخدم
        document.getElementById('lessonTitle').textContent = lesson.title;
        document.getElementById('lessonDescription').textContent = lesson.description;
        document.getElementById('lessonDuration').textContent = lesson.duration;

        // تحميل الفيديو
        this.video.src = lesson.videoUrl;
        this.video.load();

        // تحديث قائمة الدروس
        this.renderLessonsList();

        // إعداد خيارات الجودة
        this.setupQualityOptions(lesson.quality);
      }

      setupQualityOptions(qualities) {
        const qualityMenu = document.getElementById('qualityMenu');
        if (!qualities) {
          qualityMenu.innerHTML = '<div class="quality-option">غير متوفر</div>';
          return;
        }

        qualityMenu.innerHTML = Object.entries(qualities).map(([quality, url]) => `
          <div class="quality-option ${quality === '720p' ? 'active' : ''}" 
               onclick="videoPlayer.changeQuality('${quality}', '${url}')">
            ${quality}
          </div>
        `).join('');
      }

      changeQuality(quality, url) {
        this.video.src = url;
        this.video.load();
        this.video.play().catch(console.error);
        
        document.getElementById('videoQuality').textContent = `جودة ${quality}`;
        
        // تحديث الخيار النشط
        document.querySelectorAll('.quality-option').forEach(option => {
          option.classList.remove('active');
        });
        event.target.classList.add('active');
      }

      onVideoLoaded() {
        this.hideLoading();
        this.updateDuration();
        this.video.volume = this.volume;
        this.video.playbackRate = this.playbackRate;
      }

      onVideoEnded() {
        this.markLessonAsCompleted();
        this.playNextLesson();
      }

      markLessonAsCompleted() {
        if (this.currentLesson) {
          this.currentLesson.completed = true;
          this.renderLessonsList();
          
          // في التطبيق الحقيقي، إرسال طلب إلى API
          console.log(`تم إكمال الدرس: ${this.currentLesson.title}`);
        }
      }

      playNextLesson() {
        const currentIndex = this.lessons.findIndex(l => l.id === this.currentLesson.id);
        if (currentIndex < this.lessons.length - 1) {
          this.loadLesson(this.lessons[currentIndex + 1]);
        }
      }

      togglePlayPause() {
        if (this.video.paused) {
          this.play();
        } else {
          this.pause();
        }
      }

      play() {
        this.video.play().then(() => {
          this.isPlaying = true;
          this.updatePlayPauseButton();
          this.showPlayPauseOverlay('play');
        }).catch(error => {
          console.error('Error playing video:', error);
          this.showError('حدث خطأ في تشغيل الفيديو');
        });
      }

      pause() {
        this.video.pause();
        this.isPlaying = false;
        this.updatePlayPauseButton();
        this.showPlayPauseOverlay('pause');
      }

      rewind(seconds) {
        this.video.currentTime = Math.max(0, this.video.currentTime - seconds);
        this.showRewindOverlay();
      }

      forward(seconds) {
        this.video.currentTime = Math.min(this.video.duration, this.video.currentTime + seconds);
        this.showForwardOverlay();
      }

      toggleMute() {
        this.video.muted = !this.video.muted;
        this.updateMuteButton();
      }

      changeVolume(e) {
        const rect = e.currentTarget.getBoundingClientRect();
        const percent = (e.clientX - rect.left) / rect.width;
        this.volume = Math.max(0, Math.min(1, percent));
        this.video.volume = this.volume;
        this.updateVolumeSlider();
        this.updateMuteButton();
      }

      changePlaybackRate(rate) {
        this.playbackRate = parseFloat(rate);
        this.video.playbackRate = this.playbackRate;
        this.showSpeedOverlay();
      }

      increaseSpeed() {
        const rates = [0.5, 0.75, 1, 1.25, 1.5, 2];
        const currentIndex = rates.indexOf(this.playbackRate);
        if (currentIndex < rates.length - 1) {
          this.changePlaybackRate(rates[currentIndex + 1]);
          document.getElementById('playbackRate').value = rates[currentIndex + 1];
        }
      }

      decreaseSpeed() {
        const rates = [0.5, 0.75, 1, 1.25, 1.5, 2];
        const currentIndex = rates.indexOf(this.playbackRate);
        if (currentIndex > 0) {
          this.changePlaybackRate(rates[currentIndex - 1]);
          document.getElementById('playbackRate').value = rates[currentIndex - 1];
        }
      }

      seek(e) {
        const rect = e.currentTarget.getBoundingClientRect();
        const percent = (e.clientX - rect.left) / rect.width;
        this.video.currentTime = percent * this.video.duration;
      }

      toggleFullscreen() {
        if (!this.isFullscreen) {
          this.enterFullscreen();
        } else {
          this.exitFullscreen();
        }
      }

      enterFullscreen() {
        const container = document.getElementById('videoContainer');
        if (container.requestFullscreen) {
          container.requestFullscreen();
        } else if (container.webkitRequestFullscreen) {
          container.webkitRequestFullscreen();
        } else if (container.msRequestFullscreen) {
          container.msRequestFullscreen();
        }
      }

      exitFullscreen() {
        if (document.exitFullscreen) {
          document.exitFullscreen();
        } else if (document.webkitExitFullscreen) {
          document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) {
          document.msExitFullscreen();
        }
      }

      handleFullscreenChange() {
        this.isFullscreen = !!document.fullscreenElement;
        document.getElementById('exitFullscreen').style.display = this.isFullscreen ? 'block' : 'none';
        document.getElementById('videoContainer').classList.toggle('fullscreen', this.isFullscreen);
      }

      updateProgress() {
        const progress = (this.video.currentTime / this.video.duration) * 100;
        document.getElementById('progressBar').style.width = `${progress}%`;
        
        document.getElementById('currentTime').textContent = this.formatTime(this.video.currentTime);
        document.getElementById('lessonProgress').textContent = `${Math.round(progress)}% مكتمل`;
      }

      updateDuration() {
        document.getElementById('duration').textContent = this.formatTime(this.video.duration);
      }

      updatePlayPauseButton() {
        const icon = document.querySelector('#playPauseBtn i');
        icon.className = this.isPlaying ? 'bi bi-pause-fill' : 'bi bi-play-fill';
      }

      updateMuteButton() {
        const icon = document.querySelector('#muteBtn i');
        if (this.video.muted || this.volume === 0) {
          icon.className = 'bi bi-volume-mute-fill';
        } else if (this.volume < 0.5) {
          icon.className = 'bi bi-volume-down-fill';
        } else {
          icon.className = 'bi bi-volume-up-fill';
        }
        this.updateVolumeSlider();
      }

      updateVolumeSlider() {
        document.getElementById('volumeLevel').style.width = `${this.volume * 100}%`;
      }

      formatTime(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${mins}:${secs.toString().padStart(2, '0')}`;
      }

      showLoading() {
        document.getElementById('loadingOverlay').style.display = 'flex';
      }

      hideLoading() {
        document.getElementById('loadingOverlay').style.display = 'none';
      }

      showPlayPauseOverlay(action) {
        const overlay = document.getElementById('playPauseOverlay');
        const icon = overlay.querySelector('i');
        
        icon.className = action === 'play' ? 'bi bi-play-fill' : 'bi bi-pause-fill';
        overlay.style.opacity = '0.7';
        
        setTimeout(() => {
          overlay.style.opacity = '0';
        }, 500);
      }

      showRewindOverlay() {
        this.showControlFeedback('rewindBtn');
      }

      showForwardOverlay() {
        this.showControlFeedback('forwardBtn');
      }

      showSpeedOverlay() {
        this.showControlFeedback('playbackRate');
      }

      showControlFeedback(controlId) {
        const control = document.getElementById(controlId);
        control.classList.add('pulsing');
        
        setTimeout(() => {
          control.classList.remove('pulsing');
        }, 500);
      }

      showError(message) {
        // في التطبيق الحقيقي، عرض رسالة خطأ للمستخدم
        console.error(message);
      }
    }

    // تهيئة مشغل الفيديو
    const videoPlayer = new AdvancedVideoPlayer();

    // إضافة بعض التحسينات الإضافية
    document.addEventListener('DOMContentLoaded', function() {
      // إخفاء عناصر التحكم بعد فترة من عدم النشاط
      let controlsTimeout;
      const videoWrapper = document.querySelector('.video-wrapper');
      
      function hideControls() {
        document.querySelector('.controls-overlay').style.opacity = '0';
      }
      
      function showControls() {
        document.querySelector('.controls-overlay').style.opacity = '1';
        clearTimeout(controlsTimeout);
        controlsTimeout = setTimeout(hideControls, 3000);
      }
      
      videoWrapper.addEventListener('mousemove', showControls);
      videoWrapper.addEventListener('touchstart', showControls);
      
      // إخفاء العناصر في البداية
      controlsTimeout = setTimeout(hideControls, 3000);
    });
  </script>
</body>
</html>
